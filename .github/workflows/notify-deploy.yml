name: ðŸ”” Notify Deployment Ready

on:
  workflow_run:
    workflows: ["ðŸ³ Build and Push Backend Docker Image", "ðŸ…°ï¸ Build and Push Frontend Docker Image"]
    types:
      - completed
    branches: [ main ]

jobs:
  notify:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    
    steps:
    - name: ðŸ“ Deployment Notification
      run: |
        echo "ðŸš€ NUEVA IMAGEN DISPONIBLE!"
        echo "ðŸ“¦ Workflow: ${{ github.event.workflow_run.name }}"
        echo "âœ… Status: ${{ github.event.workflow_run.conclusion }}"
        echo "ðŸ• Timestamp: ${{ github.event.workflow_run.updated_at }}"
        echo ""
        echo "ðŸŽ¯ WATCHTOWER detectarÃ¡ automÃ¡ticamente la nueva imagen"
        echo "â±ï¸ ActualizaciÃ³n en mÃ¡ximo 30 segundos"
        echo "ðŸŒ Tu app se actualizarÃ¡ en: 15.235.16.229:9999"
        echo ""
        echo "âœ… NO necesitas hacer nada manualmente!"
        echo "ðŸ”„ Watchtower actualizarÃ¡ automÃ¡ticamente los contenedores"

    - name: ðŸ“Š Build Summary
      run: |
        echo "## ðŸ”„ Build & Deploy Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ“¦ Nueva imagen construida:" >> $GITHUB_STEP_SUMMARY
        echo "- **Workflow**: ${{ github.event.workflow_run.name }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Status**: âœ… Success" >> $GITHUB_STEP_SUMMARY
        echo "- **Timestamp**: ${{ github.event.workflow_run.updated_at }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸš€ Deployment automÃ¡tico:" >> $GITHUB_STEP_SUMMARY
        echo "- **MÃ©todo**: Watchtower" >> $GITHUB_STEP_SUMMARY
        echo "- **Tiempo**: ~30 segundos" >> $GITHUB_STEP_SUMMARY
        echo "- **URL**: 15.235.16.229:9999" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "âœ… **Â¡ActualizaciÃ³n automÃ¡tica completada!**"
